---
import "../styles/global.css";
---

<section
  class="flex flex-col items-center justify-center p-6 border border-[var(--borderEjercicio)] 
  bg-[var(--cardEjercicio)] shadow-[var(--shadowEjercicio)] rounded-xl transition-colors duration-300"
>
  <h3 class="text-lg font-semibold text-[var(--titles)] mb-4 text-center">
    Interactive Hydraulic Head
  </h3>

  <!-- Contenedor principal -->
  <div class="relative flex flex-col items-center">
    <img
      src="/images/exercise3-base.png"
      alt="Piezometer diagram"
      class="max-w-sm rounded-md border border-[var(--borderEjercicio)]"
    />

    <!-- 1ï¸âƒ£ Canal horizontal -->
    <div
      id="waterMiddle"
      class="absolute bottom-[3.15rem] left-[7.8rem] w-[12.6rem] bg-[#55CFFF] opacity-100 
      transition-all duration-300 ease-out"
      style="height:0px;"
    ></div>

    <!-- 2ï¸âƒ£ Tubo derecho -->
    <div
      id="waterRight"
      class="absolute bottom-[3.15rem] left-[19.15rem] w-[1.3rem] bg-[#55CFFF] opacity-100 
      transition-all duration-300 ease-out"
      style="height:0px;"
    ></div>

    <!-- 3ï¸âƒ£ Tubo izquierdo -->
    <div
      id="waterLeft"
      class="absolute bottom-[3.15rem] left-[7.8rem] w-[2.35rem] bg-[#55CFFF] opacity-100 
      transition-all duration-300 ease-out"
      style="height:0px;"
    ></div>
  </div>

  <!-- ðŸ”˜ Checkbox para alternar modo -->
  <div class="flex items-center justify-center gap-2 my-6">
    <input
      id="manualToggle"
      type="checkbox"
      class="w-4 h-4 accent-[var(--titles)] cursor-pointer"
    />
    <label
      for="manualToggle"
      class="text-[var(--textoCardCanvas)] cursor-pointer select-none"
    >
      Enable manual input mode
    </label>
  </div>

  <!-- Controles -->
  <div class="flex flex-col items-center mt-2">
    <label for="waterInput" class="text-sm text-[var(--titles)] mb-2">
      Select water level (ft): 
      <span id="waterValue" class="font-semibold ml-1">0</span>
    </label>

    <div id="inputContainer" class="flex justify-center"></div>
  </div>

  <p
    class="mt-5 text-sm text-[var(--textoCardCanvas)] text-center leading-relaxed max-w-md"
  >
    From 0 to 6 ft, the horizontal channel fills evenly.  
    After 6 ft, water begins to rise in the right and left tubes,  
    reaching heads of 12 ft and 16 ft respectively.
  </p>
</section>

<!-- âœ… Script cliente -->
<script is:client>
  const container = document.getElementById("inputContainer");
  const manualToggle = document.getElementById("manualToggle");
  const valueLabel = document.getElementById("waterValue");
  const waterMiddle = document.getElementById("waterMiddle");
  const waterRight = document.getElementById("waterRight");
  const waterLeft = document.getElementById("waterLeft");

  let currentValue = 0; // ðŸ”¹ guarda el valor actual del agua

  // ðŸ”§ crea input (slider o number)
  const createInput = (manual) => {
    container.innerHTML = ""; // limpia el contenedor

    const input = document.createElement("input");
    input.id = "waterInput";
    input.type = manual ? "number" : "range";
    input.min = 0;
    input.max = 16;
    input.step = 1;
    input.value = currentValue; // ðŸŸ¢ conserva el valor anterior
    input.className = manual
      ? "w-24 text-center border border-[var(--borderEjercicio)] rounded-md bg-[var(--cards)] text-[var(--titles)]"
      : "w-64 accent-[var(--rayaTubo)] cursor-pointer";

    input.addEventListener("input", (e) => {
      currentValue = parseFloat(e.target.value); // ðŸŸ¢ actualiza la variable global
      updateWater(currentValue);
    });

    container.appendChild(input);
  };

  // ðŸŒŠ animaciÃ³n del agua
  const updateWater = (val) => {
    valueLabel.innerText = val;
    const canalMax = 40;
    const derechoMax = 202;
    const izquierdoMax = 268;

    let canal = Math.min(val, 6) / 6 * canalMax;
    let derecho = 0;
    let izquierdo = 0;

    if (val > 6) derecho = Math.min((val - 6) / 6, 1) * derechoMax;
    if (val > 12) izquierdo = Math.min((val - 12) / 4, 1) * izquierdoMax;

    waterMiddle.style.height = canal + "px";
    waterRight.style.height = derecho + "px";
    waterLeft.style.height = izquierdo + "px";
  };

  // ðŸŽ› inicializaciÃ³n
  createInput(false);

  manualToggle.addEventListener("change", (e) => {
    createInput(e.target.checked); // ðŸŸ¢ conserva posiciÃ³n al cambiar modo
  });
</script>
